apiVersion: template.openshift.io/v1
kind: Template
labels:
  template: dedalus-cl-template
metadata:
  annotations:
    description: |-
      Cluster Logging Instance definition
      For more information about using this template, including OpenShift considerations, see https://github.com/dedalus-enterprise-architect/efk-resources/blob/main/README.md.
    iconClass: icon-d4center
    tags: dedalus-cl-instance,dedalus
  name: dedalus-cl-instance
objects:
- apiVersion: logging.openshift.io/v1
  kind: ClusterLogging
  metadata:
    name: instance
    namespace: openshift-logging
    labels:
      app: dedalus-logging
      component: instance
  spec:
    collection:
      logs:
        type: fluentd
        fluentd: {}
    logStore:
      elasticsearch:
        nodeCount: ${{ES_NODE_COUNT}}
        proxy:
          resources:
            limits:
              memory: ${PROXY_MEMORY}
            requests:
              memory: ${PROXY_MEMORY}
        redundancyPolicy: ${REDUNDANCY_POLICY}
        resources:
          limits:
            memory: ${ES_MEMORY}
          requests:
            memory: ${ES_MEMORY}
        storage:
          size: ${STORAGE_SIZE}
          storageClassName: ${STORAGECLASS}
      retentionPolicy:
        application:
          maxAge: ${RETENTION_APP}
        audit:
          maxAge: ${RETENTION_AUDIT}
        infra:
          maxAge: ${RETENTION_INFRA}
      type: elasticsearch
    managementState: Managed
    visualization:
      kibana:
        replicas: ${{KIBANA_REPLICAS}}
      type: kibana
parameters:
- name: ES_NODE_COUNT
  displayName: Elasticsearch Node Count
  description: Number of Elasticsearch nodes
  required: true
  value: "1"
- name: ES_MEMORY
  displayName: Elasticsearch Memory
  description: Memory allocation for Elasticsearch nodes
  required: true
  value: "4Gi"
- name: PROXY_MEMORY
  displayName: Proxy Memory
  description: Memory allocation for ES proxy
  required: true
  value: "256Mi"
- name: REDUNDANCY_POLICY
  displayName: Redundancy Policy
  description: "Shard redundancy policy: ZeroRedundancy, SingleRedundancy, MultipleRedundancy, FullRedundancy"
  required: true
  value: "ZeroRedundancy"
- name: STORAGE_SIZE
  displayName: Storage Size
  description: Persistent volume size per Elasticsearch node
  required: true
  value: "50G"
- name: STORAGECLASS
  displayName: Storage Class
  description: Storage Class available on the cluster
  required: false
  value: ""
- name: KIBANA_REPLICAS
  displayName: Kibana Replicas
  description: Number of Kibana replicas
  required: true
  value: "1"
- name: RETENTION_APP
  displayName: Application Log Retention
  description: Retention period for application logs
  required: true
  value: "7d"
- name: RETENTION_AUDIT
  displayName: Audit Log Retention
  description: Retention period for audit logs
  required: true
  value: "2d"
- name: RETENTION_INFRA
  displayName: Infrastructure Log Retention
  description: Retention period for infrastructure logs
  required: true
  value: "2d"
